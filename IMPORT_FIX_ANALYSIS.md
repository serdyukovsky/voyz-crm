# –ê–Ω–∞–ª–∏–∑ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–º–ø–æ—Ä—Ç–∞ —Å–¥–µ–ª–æ–∫

## üî¥ –ò—Å—Ö–æ–¥–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

**–û—à–∏–±–∫–∞:** `request entity too large` - HTTP 500 Internal Server Error

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ò–º–ø–æ—Ä—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–ª
- –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ: `exception: 'request entity too large'`
- –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ –±—ã–ª–æ –ø—É—Å—Ç—ã–º (`bodyKeys: []`, `hasRows: false`)
- –û—à–∏–±–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∞ –î–û —Ç–æ–≥–æ, –∫–∞–∫ –∑–∞–ø—Ä–æ—Å –ø–æ–ø–∞–¥–∞–ª –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä

## üîç –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

### Express –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç 100kb –¥–ª—è —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞

–ö–æ–≥–¥–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–ª CSV —Ñ–∞–π–ª —Å —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ:
```json
{
  "rows": [
    {"column1": "value1", "column2": "value2", ...},
    {...},
    // ... –º–Ω–æ–≥–æ —Å—Ç—Ä–æ–∫
  ],
  "mapping": {...},
  "pipelineId": "..."
}
```

–†–∞–∑–º–µ—Ä —ç—Ç–æ–≥–æ JSON –º–æ–≥ –ª–µ–≥–∫–æ –ø—Ä–µ–≤—ã—à–∞—Ç—å 100kb, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–æ–∫ (20+ —Å—Ç—Ä–æ–∫ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏).

### –ü–æ—á–µ–º—É —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ –±—ã–ª–æ –ø—É—Å—Ç—ã–º?

–ö–æ–≥–¥–∞ Express –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç, —á—Ç–æ —Ä–∞–∑–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç, –æ–Ω:
1. –û—Ç–∫–ª–æ–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å –î–û –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ç–µ–ª–∞
2. –í—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É "request entity too large"
3. –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (`req.body`) –æ—Å—Ç–∞–µ—Ç—Å—è –ø—É—Å—Ç—ã–º/undefined

–ü–æ—ç—Ç–æ–º—É –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ –º—ã –≤–∏–¥–µ–ª–∏ –ø—É—Å—Ç–æ–π DTO - –∑–∞–ø—Ä–æ—Å –¥–∞–∂–µ –Ω–µ –¥–æ—Ö–æ–¥–∏–ª –¥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ body parser –≤ NestJS

```typescript
const app = await NestFactory.create(AppModule, {
  bodyParser: false, // –û—Ç–∫–ª—é—á–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–∞—Ä—Å–µ—Ä —Å –ª–∏–º–∏—Ç–æ–º 100kb
});
```

### 2. –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Express body parser —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º –ª–∏–º–∏—Ç–æ–º

```typescript
const httpAdapter = app.getHttpAdapter();
const expressApp = httpAdapter.getInstance();
expressApp.use(express.json({ limit: '50mb' }));      // –õ–∏–º–∏—Ç 50mb –¥–ª—è JSON
expressApp.use(express.urlencoded({ limit: '50mb', extended: true })); // –î–ª—è URL-encoded
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

- **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** –õ–∏–º–∏—Ç 100kb ‚Üí –∑–∞–ø—Ä–æ—Å—ã > 100kb –æ—Ç–∫–ª–æ–Ω—è–ª–∏—Å—å
- **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** –õ–∏–º–∏—Ç 50mb ‚Üí –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ñ–∞–π–ª—ã –¥–æ 50 –º–µ–≥–∞–±–∞–π—Ç

### –ü–æ—á–µ–º—É 50mb?

- –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–∂–µ –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö CSV —Ñ–∞–π–ª–æ–≤ (—Ç—ã—Å—è—á–∏ —Å—Ç—Ä–æ–∫)
- –ü—Ä–∏ —ç—Ç–æ–º –Ω–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π, —á—Ç–æ–±—ã –∑–∞—â–∏—Ç–∏—Ç—å –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π
- –¢–∏–ø–∏—á–Ω—ã–π CSV —Ñ–∞–π–ª —Å 1000 —Å—Ç—Ä–æ–∫ –∏ 10 –∫–æ–ª–æ–Ω–∫–∞–º–∏ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ –∑–∞–Ω–∏–º–∞–µ—Ç ~1-5mb

## üéØ –ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç

**–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –ù–ï –≤ –ª–æ–≥–∏–∫–µ –∏–º–ø–æ—Ä—Ç–∞, –∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Express middleware!**

–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–≤–∞–ª–∏–¥–∞—Ü–∏—è pipelineId, —É–ª—É—á—à–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è) –±—ã–ª–∏ –ø–æ–ª–µ–∑–Ω—ã–º–∏ —É–ª—É—á—à–µ–Ω–∏—è–º–∏, –Ω–æ **–∫–ª—é—á–µ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ** - —ç—Ç–æ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞ —Å 100kb –¥–æ 50mb.

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã)

–•–æ—Ç—è –æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ –ª–∏–º–∏—Ç–µ —Ä–∞–∑–º–µ—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞, –º—ã —Ç–∞–∫–∂–µ —É–ª—É—á—à–∏–ª–∏:

1. **–í–∞–ª–∏–¥–∞—Ü–∏—é pipelineId** - –±–æ–ª–µ–µ —á–µ—Ç–∫–∏–µ –æ—à–∏–±–∫–∏
2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫** - –ª—É—á—à–µ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
3. **–û–±—Ä–∞–±–æ—Ç–∫—É null/undefined** - –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–π –∫–æ–¥

–ù–æ —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—ã–ª–∏ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–º–∏ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–±–ª–µ–º—ã - –æ–Ω–∏ –ø—Ä–æ—Å—Ç–æ —Å–¥–µ–ª–∞–ª–∏ –∫–æ–¥ –ª—É—á—à–µ.



