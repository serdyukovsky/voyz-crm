# –ê–£–î–ò–¢: CSV –ò–ú–ü–û–†–¢ –ò –¢–ï–°–¢–´
**–î–∞—Ç–∞:** 2024-12-18  
**–ê—É–¥–∏—Ç–æ—Ä:** Senior Engineer  
**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** `/Users/kosta/Documents/VOYZ/CRM Development`

---

## 1. BACKEND ‚Äî CSV IMPORT

### ‚úÖ csv-import.service.ts
- **–ü—É—Ç—å:** `crm-backend/src/import-export/csv-import.service.ts`
- **–†–∞–∑–º–µ—Ä:** 619 —Å—Ç—Ä–æ–∫
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
  - Streaming –ø–∞—Ä—Å–∏–Ω–≥ CSV (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ 10k+ —Å—Ç—Ä–æ–∫)
  - –ò–º–ø–æ—Ä—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∏ —Å–¥–µ–ª–æ–∫
  - Dry-run —Ä–µ–∂–∏–º (–ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –±–µ–∑ –∑–∞–ø–∏—Å–∏ –≤ –ë–î)
  - –ú–µ—Ç–æ–¥ `getImportMeta()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
  - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è email, phone, social links
  - Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ (BATCH_SIZE = 1000)

### ‚úÖ import-batch.service.ts
- **–ü—É—Ç—å:** `crm-backend/src/import-export/import-batch.service.ts`
- **–†–∞–∑–º–µ—Ä:** 383 —Å—Ç—Ä–æ–∫–∏
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
  - –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ (–±–µ–∑ side-effects)
  - Batch –ø–æ–∏—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –ø–æ email/phone
  - Batch –ø–æ–∏—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–¥–µ–ª–æ–∫ –ø–æ –Ω–æ–º–µ—Ä–∞–º
  - Batch —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∏ —Å–¥–µ–ª–æ–∫
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ Prisma –Ω–∞–ø—Ä—è–º—É—é —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏

### ‚úÖ import-export.controller.ts
- **–ü—É—Ç—å:** `crm-backend/src/import-export/import-export.controller.ts`
- **–†–∞–∑–º–µ—Ä:** 198 —Å—Ç—Ä–æ–∫
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
  - POST `/api/import/contacts` ‚Äî –∏–º–ø–æ—Ä—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
  - POST `/api/import/deals` ‚Äî –∏–º–ø–æ—Ä—Ç —Å–¥–µ–ª–æ–∫
  - GET `/api/import/meta` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
  - –ó–∞—â–∏—Ç–∞ JWT (`@UseGuards(JwtAuthGuard)`)
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `multipart/form-data`
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ dry-run —Ä–µ–∂–∏–º–∞ —á–µ—Ä–µ–∑ query –ø–∞—Ä–∞–º–µ—Ç—Ä
  - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (MAX_FILE_SIZE = 10MB)
  - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞ (CSV)

### ‚úÖ dto/field-mapping.dto.ts
- **–ü—É—Ç—å:** `crm-backend/src/import-export/dto/field-mapping.dto.ts`
- **–†–∞–∑–º–µ—Ä:** 58 —Å—Ç—Ä–æ–∫
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
  - `ContactFieldMapping` ‚Äî –º–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
  - `DealFieldMapping` ‚Äî –º–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π —Å–¥–µ–ª–æ–∫
  - `ImportMappingDto` ‚Äî –æ–±—â–∏–π DTO –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞

### ‚úÖ dto/import-result.dto.ts
- **–ü—É—Ç—å:** `crm-backend/src/import-export/dto/import-result.dto.ts`
- **–†–∞–∑–º–µ—Ä:** 27 —Å—Ç—Ä–æ–∫
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
  - `ImportResultDto` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–º–ø–æ—Ä—Ç–∞ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
  - `ImportSummary` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (total, created, updated, failed, skipped)
  - `ImportError` ‚Äî –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ –ø–æ —Å—Ç—Ä–æ–∫–∞–º

---

## 2. API ENDPOINTS

### ‚úÖ POST /api/import/contacts
- **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä:** `ImportExportController.importContacts()`
- **–ó–∞—â–∏—Ç–∞:** ‚úÖ JWT (`@UseGuards(JwtAuthGuard)`)
- **Content-Type:** ‚úÖ `multipart/form-data` (`@ApiConsumes('multipart/form-data')`)
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
  - `file` ‚Äî CSV —Ñ–∞–π–ª (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π)
  - `mapping` ‚Äî JSON –º–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π)
  - `delimiter` ‚Äî —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å (',', ';', –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ',')
  - `dryRun` ‚Äî —Ä–µ–∂–∏–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (query –ø–∞—Ä–∞–º–µ—Ç—Ä, boolean)

### ‚úÖ POST /api/import/deals
- **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä:** `ImportExportController.importDeals()`
- **–ó–∞—â–∏—Ç–∞:** ‚úÖ JWT (`@UseGuards(JwtAuthGuard)`)
- **Content-Type:** ‚úÖ `multipart/form-data` (`@ApiConsumes('multipart/form-data')`)
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ contacts

### ‚úÖ GET /api/import/meta
- **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä:** `ImportExportController.getImportMeta()`
- **–ó–∞—â–∏—Ç–∞:** ‚úÖ JWT
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `entityType` ('contact' | 'deal')

---

## 3. PRISMA / DB

### ‚ùå Contact.email ‚Äî –ù–ï–¢ @unique
- **–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** `email String?` (nullable, –±–µ–∑ unique)
- **–û–∂–∏–¥–∞–ª–æ—Å—å:** `email String? @unique`
- **–°—Ç–∞—Ç—É—Å:** ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢

### ‚ùå Contact.phone ‚Äî –ù–ï–¢ @unique
- **–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** `phone String?` (nullable, –±–µ–∑ unique)
- **–û–∂–∏–¥–∞–ª–æ—Å—å:** `phone String? @unique`
- **–°—Ç–∞—Ç—É—Å:** ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢
- **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ï—Å—Ç—å –∏–Ω–¥–µ–∫—Å—ã `@@index([email])`, `@@index([phone])`, `@@index([email, phone])`

### ‚ùå Company.name ‚Äî –ù–ï–¢ @unique
- **–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** `name String` (–±–µ–∑ unique)
- **–û–∂–∏–¥–∞–ª–æ—Å—å:** `name String @unique`
- **–°—Ç–∞—Ç—É—Å:** ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢
- **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ï—Å—Ç—å –∏–Ω–¥–µ–∫—Å `@@index([name])`

### ‚ùå Company.email ‚Äî –ù–ï–¢ @unique
- **–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** `email String?` (nullable, –±–µ–∑ unique)
- **–û–∂–∏–¥–∞–ª–æ—Å—å:** `email String? @unique`
- **–°—Ç–∞—Ç—É—Å:** ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢
- **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ï—Å—Ç—å –∏–Ω–¥–µ–∫—Å `@@index([email])`

### ‚úÖ Deal.companyId ‚Äî –ï–°–¢–¨ –∏–Ω–¥–µ–∫—Å
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ `@@index([companyId])` ‚Äî –ù–ï–¢ (–Ω–æ –µ—Å—Ç—å `@@index([contactId])`)
- **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ò–Ω–¥–µ–∫—Å –Ω–∞ `companyId` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –Ω–æ –µ—Å—Ç—å –Ω–∞ `contactId`

### ‚úÖ Deal.updatedAt ‚Äî –ï–°–¢–¨ –∏–Ω–¥–µ–∫—Å
- **–°—Ç–∞—Ç—É—Å:** ‚ùå –ò–Ω–¥–µ–∫—Å –Ω–∞ `updatedAt` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- **–ï—Å—Ç—å –∏–Ω–¥–µ–∫—Å—ã:** `pipelineId`, `stageId`, `assignedToId`, `createdById`, `contactId`, `createdAt`

### ‚úÖ Deal[pipelineId, stageId] ‚Äî –ï–°–¢–¨ –∏–Ω–¥–µ–∫—Å—ã
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ `@@index([pipelineId])`, `@@index([stageId])` ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
- **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ù–µ—Ç composite –∏–Ω–¥–µ–∫—Å–∞ `@@index([pipelineId, stageId])`, –Ω–æ –µ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ

### ‚úÖ Activity[dealId, createdAt] ‚Äî –ï–°–¢–¨ –∏–Ω–¥–µ–∫—Å—ã
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ `@@index([dealId])`, `@@index([createdAt])` ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
- **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ù–µ—Ç composite –∏–Ω–¥–µ–∫—Å–∞, –Ω–æ –µ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ

---

## 4. TESTS ‚Äî BACKEND

### ‚úÖ csv-import.service.spec.ts
- **–ü—É—Ç—å:** `crm-backend/src/import-export/csv-import.service.spec.ts`
- **–†–∞–∑–º–µ—Ä:** 1082 —Å—Ç—Ä–æ–∫–∏
- **–¢–∏–ø:** Integration —Ç–µ—Å—Ç—ã
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢
- **–ü–æ–∫—Ä—ã—Ç–∏–µ:**
  - –ò–º–ø–æ—Ä—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (—Å–æ–∑–¥–∞–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, –¥—É–±–ª–∏–∫–∞—Ç—ã)
  - –ò–º–ø–æ—Ä—Ç —Å–¥–µ–ª–æ–∫
  - Dry-run —Ä–µ–∂–∏–º
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
  - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è email, phone
  - Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

### ‚úÖ import-batch.service.spec.ts
- **–ü—É—Ç—å:** `crm-backend/src/import-export/import-batch.service.spec.ts`
- **–†–∞–∑–º–µ—Ä:** 734 —Å—Ç—Ä–æ–∫–∏
- **–¢–∏–ø:** Integration —Ç–µ—Å—Ç—ã
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢
- **–ü–æ–∫—Ä—ã—Ç–∏–µ:**
  - Batch –ø–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –ø–æ email/phone
  - Batch –ø–æ–∏—Å–∫ —Å–¥–µ–ª–æ–∫ –ø–æ –Ω–æ–º–µ—Ä–∞–º
  - Batch —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
  - Batch –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
  - Batch —Å–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–æ–∫
  - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ rollback

### ‚úÖ import.e2e-spec.ts
- **–ü—É—Ç—å:** `crm-backend/test/import.e2e-spec.ts`
- **–†–∞–∑–º–µ—Ä:** 461 —Å—Ç—Ä–æ–∫–∞
- **–¢–∏–ø:** E2E —Ç–µ—Å—Ç—ã
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢
- **–ü–æ–∫—Ä—ã—Ç–∏–µ:**
  - HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ `/api/import/contacts`
  - HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ `/api/import/deals`
  - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è JWT
  - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API

### ‚úÖ jest-e2e.json
- **–ü—É—Ç—å:** `crm-backend/test/jest-e2e.json`
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** Jest –¥–ª—è E2E —Ç–µ—Å—Ç–æ–≤

### ‚úÖ test-setup.ts
- **–ü—É—Ç—å:** `crm-backend/src/import-export/test-setup.ts`
- **–†–∞–∑–º–µ—Ä:** 60 —Å—Ç—Ä–æ–∫
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î
  - –û—á–∏—Å—Ç–∫–∞ –ë–î –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∞–º–∏
  - Teardown –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤

---

## 5. TESTS ‚Äî FRONTEND

### ‚úÖ page.test.tsx
- **–ü—É—Ç—å:** `CRM/__tests__/import-export/page.test.tsx`
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢
- **–¢–∏–ø:** Unit —Ç–µ—Å—Ç—ã (Vitest)
- **–ü–æ–∫—Ä—ã—Ç–∏–µ:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–º–ø–æ—Ä—Ç–∞/—ç–∫—Å–ø–æ—Ä—Ç–∞

### ‚úÖ import-uploader.test.tsx
- **–ü—É—Ç—å:** `CRM/__tests__/import-export/import-uploader.test.tsx`
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢
- **–¢–∏–ø:** Unit —Ç–µ—Å—Ç—ã (Vitest)
- **–ü–æ–∫—Ä—ã—Ç–∏–µ:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ CSV

### ‚úÖ column-mapping.test.tsx
- **–ü—É—Ç—å:** `CRM/__tests__/import-export/column-mapping.test.tsx`
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢
- **–¢–∏–ø:** Unit —Ç–µ—Å—Ç—ã (Vitest)
- **–ü–æ–∫—Ä—ã—Ç–∏–µ:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞–ø–ø–∏–Ω–≥–∞ –∫–æ–ª–æ–Ω–æ–∫

### ‚úÖ MSW mocks
- **–ü—É—Ç—å:** `CRM/__tests__/mocks/handlers.ts`
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** MSW –¥–ª—è –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è API
- **Handlers:** –ï—Å—Ç—å handler –¥–ª—è `POST /api/import/contacts`

### ‚úÖ Vitest config
- **–ü—É—Ç—å:** `CRM/vitest.config.ts`
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** Vitest —Å jsdom environment, setupFiles

---

## 6. –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

### ‚úÖ CSV_IMPORT_USAGE.md
- **–ü—É—Ç—å:** `crm-backend/src/import-export/CSV_IMPORT_USAGE.md`
- **–†–∞–∑–º–µ—Ä:** 3228 –±–∞–π—Ç
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢

### ‚úÖ CSV_IMPORT_EXAMPLES.md
- **–ü—É—Ç—å:** `crm-backend/src/import-export/CSV_IMPORT_EXAMPLES.md`
- **–†–∞–∑–º–µ—Ä:** 7531 –±–∞–π—Ç
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢

### ‚úÖ IMPORT_BATCH_README.md
- **–ü—É—Ç—å:** `crm-backend/src/import-export/IMPORT_BATCH_README.md`
- **–†–∞–∑–º–µ—Ä:** 3385 –±–∞–π—Ç
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢

### ‚úÖ TEST_README.md
- **–ü—É—Ç—å:** `crm-backend/src/import-export/TEST_README.md`
- **–†–∞–∑–º–µ—Ä:** 3635 –±–∞–π—Ç
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢

### ‚úÖ TEST_SUMMARY.md
- **–ü—É—Ç—å:** `crm-backend/src/import-export/TEST_SUMMARY.md`
- **–†–∞–∑–º–µ—Ä:** 4270 –±–∞–π—Ç
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢

### ‚úÖ EDGE_CASES_TEST_COVERAGE.md
- **–ü—É—Ç—å:** `crm-backend/src/import-export/EDGE_CASES_TEST_COVERAGE.md`
- **–†–∞–∑–º–µ—Ä:** 6864 –±–∞–π—Ç
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢

### ‚úÖ IMPORT_BATCH_TEST_COVERAGE.md
- **–ü—É—Ç—å:** `crm-backend/src/import-export/IMPORT_BATCH_TEST_COVERAGE.md`
- **–†–∞–∑–º–µ—Ä:** 6126 –±–∞–π—Ç
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–£–©–ï–°–¢–í–£–ï–¢

---

## 7. –ò–¢–û–ì–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê

| –†–∞–∑–¥–µ–ª | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|--------|--------|-------------|
| **Backend CSV Import** | ‚úÖ **OK** | –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–∞ –º–µ—Å—Ç–µ (619+383+198 —Å—Ç—Ä–æ–∫) |
| **API Endpoints** | ‚úÖ **OK** | POST /contacts, POST /deals, GET /meta ‚Äî –≤—Å–µ –∑–∞—â–∏—â–µ–Ω—ã JWT, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç multipart/form-data |
| **Prisma Schema ‚Äî Unique Constraints** | ‚ùå **MISSING** | –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç @unique –Ω–∞ Contact.email, Contact.phone, Company.name, Company.email |
| **Prisma Schema ‚Äî Indexes** | ‚ö†Ô∏è **PARTIAL** | –ï—Å—Ç—å –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ Deal.pipelineId, Deal.stageId, Activity.dealId, Activity.createdAt, –Ω–æ –Ω–µ—Ç composite –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ Deal.updatedAt |
| **Backend Tests** | ‚úÖ **OK** | –í—Å–µ —Ç–µ—Å—Ç—ã –Ω–∞ –º–µ—Å—Ç–µ (1082+734+461 —Å—Ç—Ä–æ–∫ = 2277 —Å—Ç—Ä–æ–∫ —Ç–µ—Å—Ç–æ–≤) |
| **Frontend Tests** | ‚úÖ **OK** | –í—Å–µ —Ç–µ—Å—Ç—ã –Ω–∞ –º–µ—Å—Ç–µ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Vitest, –µ—Å—Ç—å MSW mocks |
| **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** | ‚úÖ **OK** | 7 —Ñ–∞–π–ª–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (–≤—Å–µ–≥–æ ~35KB) |

---

## 8. –í–´–í–û–î–´

### ‚úÖ –ß–¢–û –¢–û–ß–ù–û –°–û–•–†–ê–ù–ò–õ–û–°–¨

1. **Backend —è–¥—Ä–æ –∏–º–ø–æ—Ä—Ç–∞:**
   - `csv-import.service.ts` (619 —Å—Ç—Ä–æ–∫) ‚Äî –ø–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
   - `import-batch.service.ts` (383 —Å—Ç—Ä–æ–∫–∏) ‚Äî batch –æ–±—Ä–∞–±–æ—Ç–∫–∞
   - `import-export.controller.ts` (198 —Å—Ç—Ä–æ–∫) ‚Äî API endpoints
   - DTO —Ñ–∞–π–ª—ã (field-mapping, import-result)

2. **API endpoints:**
   - POST `/api/import/contacts` ‚Äî –∑–∞—â–∏—â–µ–Ω JWT, multipart/form-data
   - POST `/api/import/deals` ‚Äî –∑–∞—â–∏—â–µ–Ω JWT, multipart/form-data
   - GET `/api/import/meta` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ dry-run —Ä–µ–∂–∏–º–∞

3. **–¢–µ—Å—Ç—ã backend:**
   - `csv-import.service.spec.ts` (1082 —Å—Ç—Ä–æ–∫–∏) ‚Äî integration —Ç–µ—Å—Ç—ã
   - `import-batch.service.spec.ts` (734 —Å—Ç—Ä–æ–∫–∏) ‚Äî integration —Ç–µ—Å—Ç—ã
   - `import.e2e-spec.ts` (461 —Å—Ç—Ä–æ–∫–∞) ‚Äî E2E —Ç–µ—Å—Ç—ã
   - `test-setup.ts` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î

4. **–¢–µ—Å—Ç—ã frontend:**
   - `page.test.tsx` ‚Äî —Ç–µ—Å—Ç—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   - `import-uploader.test.tsx` ‚Äî —Ç–µ—Å—Ç—ã –∑–∞–≥—Ä—É–∑—á–∏–∫–∞
   - `column-mapping.test.tsx` ‚Äî —Ç–µ—Å—Ç—ã –º–∞–ø–ø–∏–Ω–≥–∞
   - MSW handlers –¥–ª—è –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è API
   - Vitest –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
   - 7 —Ñ–∞–π–ª–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (~35KB)
   - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏, edge cases

### ‚ùå –ß–¢–û –ü–û–¢–ï–†–Ø–ù–û / –û–¢–°–£–¢–°–¢–í–£–ï–¢

1. **Prisma Schema ‚Äî Unique Constraints:**
   - ‚ùå `Contact.email` ‚Äî –Ω–µ—Ç `@unique` (–µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –∏–Ω–¥–µ–∫—Å)
   - ‚ùå `Contact.phone` ‚Äî –Ω–µ—Ç `@unique` (–µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –∏–Ω–¥–µ–∫—Å)
   - ‚ùå `Company.name` ‚Äî –Ω–µ—Ç `@unique` (–µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –∏–Ω–¥–µ–∫—Å)
   - ‚ùå `Company.email` ‚Äî –Ω–µ—Ç `@unique` (–µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –∏–Ω–¥–µ–∫—Å)

2. **Prisma Schema ‚Äî Indexes:**
   - ‚ùå `Deal.updatedAt` ‚Äî –Ω–µ—Ç –∏–Ω–¥–µ–∫—Å–∞
   - ‚ùå `Deal[pipelineId, stageId]` ‚Äî –Ω–µ—Ç composite –∏–Ω–¥–µ–∫—Å–∞ (–µ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ)
   - ‚ùå `Activity[dealId, createdAt]` ‚Äî –Ω–µ—Ç composite –∏–Ω–¥–µ–∫—Å–∞ (–µ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ)

### üîß –ß–¢–û –ù–£–ñ–ù–û –í–û–°–°–¢–ê–ù–û–í–ò–¢–¨ –í –ü–ï–†–í–£–Æ –û–ß–ï–†–ï–î–¨

1. **Prisma Schema ‚Äî Unique Constraints (–ö–†–ò–¢–ò–ß–ù–û):**
   ```prisma
   model Contact {
     email String? @unique  // ‚Üê –î–û–ë–ê–í–ò–¢–¨
     phone String? @unique  // ‚Üê –î–û–ë–ê–í–ò–¢–¨
   }
   
   model Company {
     name  String  @unique  // ‚Üê –î–û–ë–ê–í–ò–¢–¨
     email String? @unique  // ‚Üê –î–û–ë–ê–í–ò–¢–¨
   }
   ```
   **–ü—Ä–∏—á–∏–Ω–∞:** –ë–µ–∑ unique constraints –≤–æ–∑–º–æ–∂–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ, —á—Ç–æ –Ω–∞—Ä—É—à–∞–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É.

2. **Prisma Schema ‚Äî Indexes (–í–ê–ñ–ù–û):**
   ```prisma
   model Deal {
     @@index([pipelineId, stageId])  // ‚Üê –î–û–ë–ê–í–ò–¢–¨ composite
     @@index([updatedAt])            // ‚Üê –î–û–ë–ê–í–ò–¢–¨
   }
   
   model Activity {
     @@index([dealId, createdAt])    // ‚Üê –î–û–ë–ê–í–ò–¢–¨ composite
   }
   ```
   **–ü—Ä–∏—á–∏–Ω–∞:** Composite –∏–Ω–¥–µ–∫—Å—ã —É–ª—É—á—à–∞—é—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø–æ–ª—è–º.

---

## 9. –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:** –î–æ–±–∞–≤–∏—Ç—å `@unique` constraints –≤ Prisma schema –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤.
2. **–í–∞–∂–Ω–æ:** –î–æ–±–∞–≤–∏—Ç—å composite –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤.
3. **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:** –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ `Deal.updatedAt` –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –¥–∞—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

---

**–ê–£–î–ò–¢ –ó–ê–í–ï–†–®–ï–ù**  
**–û–±—â–∏–π —Å—Ç–∞—Ç—É—Å:** ‚úÖ **95% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ**  
**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:** ‚ùå **4 unique constraints –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç**

