<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üöÄ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è CRM</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 600px;
      width: 100%;
      padding: 40px;
    }
    
    h1 {
      color: #1a202c;
      margin-bottom: 10px;
      font-size: 28px;
    }
    
    .subtitle {
      color: #718096;
      margin-bottom: 30px;
      font-size: 14px;
    }
    
    .info-box {
      background: #edf2f7;
      border-left: 4px solid #4299e1;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 24px;
    }
    
    .info-box h3 {
      color: #2d3748;
      font-size: 16px;
      margin-bottom: 8px;
    }
    
    .info-box ul {
      list-style: none;
      padding-left: 0;
    }
    
    .info-box li {
      color: #4a5568;
      padding: 4px 0;
      font-size: 14px;
    }
    
    .info-box li:before {
      content: "‚úì ";
      color: #48bb78;
      font-weight: bold;
      margin-right: 8px;
    }
    
    .button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 16px 32px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }
    
    .button:active {
      transform: translateY(0);
    }
    
    .button:disabled {
      background: #cbd5e0;
      cursor: not-allowed;
      transform: none;
    }
    
    .log {
      margin-top: 24px;
      background: #1a202c;
      color: #e2e8f0;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      max-height: 300px;
      overflow-y: auto;
      display: none;
    }
    
    .log.show {
      display: block;
    }
    
    .log-line {
      padding: 4px 0;
      line-height: 1.5;
    }
    
    .log-success {
      color: #68d391;
    }
    
    .log-error {
      color: #fc8181;
    }
    
    .log-info {
      color: #63b3ed;
    }
    
    .warning-box {
      background: #fef5e7;
      border-left: 4px solid #f59e0b;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 24px;
      font-size: 14px;
      color: #92400e;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üöÄ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö</h1>
    <p class="subtitle">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –≤–æ—Ä–æ–Ω–∫–∏, —ç—Ç–∞–ø–æ–≤ –∏ —Å–¥–µ–ª–æ–∫</p>
    
    <div class="info-box">
      <h3>üìã –ß—Ç–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ:</h3>
      <ul>
        <li>1 Pipeline: "–ü—Ä–æ–¥–∞–∂–∏ ‚Äî –¢–µ—Å—Ç–æ–≤–∞—è –≤–æ—Ä–æ–Ω–∫–∞"</li>
        <li>6 —ç—Ç–∞–ø–æ–≤: –æ—Ç "–ù–æ–≤—ã–π –ª–∏–¥" –¥–æ "–ó–∞–∫—Ä—ã—Ç–æ-–í—ã–∏–≥—Ä–∞–Ω–æ/–ü—Ä–æ–∏–≥—Ä–∞–Ω–æ"</li>
        <li>7 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–¥–µ–ª–æ–∫ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —ç—Ç–∞–ø–∞—Ö</li>
      </ul>
    </div>
    
    <div class="warning-box">
      ‚ö†Ô∏è <strong>–í–∞–∂–Ω–æ:</strong> –û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞ —Ç–æ–º –∂–µ –¥–æ–º–µ–Ω–µ —á—Ç–æ –∏ CRM (localhost:5173 –∏–ª–∏ –≤–∞—à Codespace URL)
    </div>
    
    <button class="button" id="createBtn" onclick="createTestData()">
      –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    </button>
    
    <div class="log" id="log"></div>
  </div>

  <script>
    const API_BASE_URL = 'https://fictional-capybara-69qpv47gj7rgcrx65-3001.app.github.dev/api';
    
    const PIPELINE_CONFIG = {
      name: 'üöÄ –ü—Ä–æ–¥–∞–∂–∏ ‚Äî –¢–µ—Å—Ç–æ–≤–∞—è –≤–æ—Ä–æ–Ω–∫–∞',
      description: '–¢–µ—Å—Ç–æ–≤–∞—è –≤–æ—Ä–æ–Ω–∫–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –∏–º–ø–æ—Ä—Ç–∞ –∏ —Ä–∞–±–æ—Ç—ã —Å CRM',
      isDefault: true,
    };

    const STAGES_CONFIG = [
      { name: '–ù–æ–≤—ã–π –ª–∏–¥', color: '#94a3b8', order: 0, isDefault: true },
      { name: '–ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è', color: '#3b82f6', order: 1 },
      { name: '–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã', color: '#f59e0b', order: 2 },
      { name: '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ö–ü', color: '#8b5cf6', order: 3 },
      { name: '–ó–∞–∫—Ä—ã—Ç–æ-–í—ã–∏–≥—Ä–∞–Ω–æ', color: '#10b981', order: 4, isClosed: true },
      { name: '–ó–∞–∫—Ä—ã—Ç–æ-–ü—Ä–æ–∏–≥—Ä–∞–Ω–æ', color: '#ef4444', order: 5, isClosed: true },
    ];

    const TEST_DEALS = [
      {
        title: '–í–Ω–µ–¥—Ä–µ–Ω–∏–µ CRM —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –û–û–û "–ê–ª—å—Ñ–∞"',
        number: 'DEAL-001',
        amount: 450000,
        stageName: '–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã',
        description: '–ö—Ä—É–ø–Ω—ã–π –∫–ª–∏–µ–Ω—Ç, –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω –≤–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏–∏ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ CRM',
      },
      {
        title: '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ ‚Äî –ò–ü –ü–µ—Ç—Ä–æ–≤',
        number: 'DEAL-002',
        amount: 75000,
        stageName: '–ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è',
        description: '–ù–µ–±–æ–ª—å—à–æ–π –ø—Ä–æ–µ–∫—Ç, –æ–±—Å—É–∂–¥–∞–µ–º –æ–±—ä–µ–º —Ä–∞–±–æ—Ç',
      },
      {
        title: '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å 1–° ‚Äî –û–û–û "–ë–µ—Ç–∞"',
        number: 'DEAL-003',
        amount: 320000,
        stageName: '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ö–ü',
        description: '–ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ 2 –¥–Ω—è –Ω–∞–∑–∞–¥',
      },
      {
        title: '–¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞ CRM ‚Äî –û–û–û "–ì–∞–º–º–∞"',
        number: 'DEAL-004',
        amount: 150000,
        stageName: '–ó–∞–∫—Ä—ã—Ç–æ-–í—ã–∏–≥—Ä–∞–Ω–æ',
        description: '–ö–æ–Ω—Ç—Ä–∞–∫—Ç –ø–æ–¥–ø–∏—Å–∞–Ω, –Ω–∞—á–∏–Ω–∞–µ–º —Ä–∞–±–æ—Ç—É',
      },
      {
        title: '–û–±—É—á–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞ ‚Äî –ò–ü –°–∏–¥–æ—Ä–æ–≤',
        number: 'DEAL-005',
        amount: 50000,
        stageName: '–ù–æ–≤—ã–π –ª–∏–¥',
        description: '–í—Ö–æ–¥—è—â–∞—è –∑–∞—è–≤–∫–∞, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–≤–∏—á–Ω–∞—è –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è',
      },
      {
        title: '–î–æ—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥—É–ª–µ–π CRM ‚Äî –û–û–û "–î–µ–ª—å—Ç–∞"',
        number: 'DEAL-006',
        amount: 280000,
        stageName: '–ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è',
        description: '–£—Ç–æ—á–Ω—è–µ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –¥–æ—Ä–∞–±–æ—Ç–∫–∞–º',
      },
      {
        title: '–ö–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥ –ø–æ –ø—Ä–æ—Ü–µ—Å—Å–∞–º ‚Äî –ó–ê–û "–≠–ø—Å–∏–ª–æ–Ω"',
        number: 'DEAL-007',
        amount: 95000,
        stageName: '–ó–∞–∫—Ä—ã—Ç–æ-–ü—Ä–æ–∏–≥—Ä–∞–Ω–æ',
        description: '–ö–ª–∏–µ–Ω—Ç –≤—ã–±—Ä–∞–ª –¥—Ä—É–≥–æ–≥–æ –ø–æ–¥—Ä—è–¥—á–∏–∫–∞',
      },
    ];

    const logContainer = document.getElementById('log');
    const createBtn = document.getElementById('createBtn');

    function log(message, type = 'info') {
      logContainer.classList.add('show');
      const line = document.createElement('div');
      line.className = `log-line log-${type}`;
      
      const timestamp = new Date().toLocaleTimeString('ru-RU');
      line.textContent = `[${timestamp}] ${message}`;
      
      logContainer.appendChild(line);
      logContainer.scrollTop = logContainer.scrollHeight;
    }

    async function apiRequest(endpoint, method = 'GET', body = null) {
      const token = localStorage.getItem('access_token');
      if (!token) {
        throw new Error('–ù–µ –Ω–∞–π–¥–µ–Ω access_token. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É.');
      }

      const url = `${API_BASE_URL}${endpoint}`;
      const options = {
        method,
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`,
        },
      };

      if (body) {
        options.body = JSON.stringify(body);
      }

      const response = await fetch(url, options);

      if (!response.ok) {
        const errorText = await response.text();
        throw new Error(`API Error ${response.status}: ${errorText}`);
      }

      return response.json();
    }

    async function createTestData() {
      createBtn.disabled = true;
      createBtn.textContent = '–°–æ–∑–¥–∞–Ω–∏–µ...';
      logContainer.innerHTML = '';

      try {
        log('üéØ –ù–∞—á–∏–Ω–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö...', 'info');
        
        // –®–∞–≥ 1: –°–æ–∑–¥–∞—ë–º pipeline
        log('üìä –°–æ–∑–¥–∞–Ω–∏–µ pipeline...', 'info');
        const pipeline = await apiRequest('/pipelines', 'POST', PIPELINE_CONFIG);
        log(`‚úÖ Pipeline —Å–æ–∑–¥–∞–Ω: "${pipeline.name}"`, 'success');

        // –®–∞–≥ 2: –°–æ–∑–¥–∞—ë–º stages
        log('üé® –°–æ–∑–¥–∞–Ω–∏–µ —ç—Ç–∞–ø–æ–≤...', 'info');
        const stages = [];
        const stageMap = {};
        
        for (const stageConfig of STAGES_CONFIG) {
          const stage = await apiRequest(
            `/pipelines/${pipeline.id}/stages`,
            'POST',
            stageConfig
          );
          stages.push(stage);
          stageMap[stage.name] = stage.id;
          log(`  ‚úì –≠—Ç–∞–ø: "${stage.name}"`, 'success');
        }

        // –®–∞–≥ 3: –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        log('üë§ –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ...', 'info');
        const user = await apiRequest('/auth/me');
        log(`‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.firstName} ${user.lastName}`, 'success');

        // –®–∞–≥ 4: –°–æ–∑–¥–∞—ë–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–¥–µ–ª–∫–∏
        log('üíº –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–¥–µ–ª–æ–∫...', 'info');
        for (const dealData of TEST_DEALS) {
          const dealPayload = {
            title: dealData.title,
            number: dealData.number,
            amount: dealData.amount,
            stageId: stageMap[dealData.stageName],
            description: dealData.description,
            pipelineId: pipeline.id,
            assignedToId: user.id,
          };

          const deal = await apiRequest('/deals', 'POST', dealPayload);
          log(`  ‚úì "${deal.title}" ‚Üí ${dealData.stageName}`, 'success');
        }

        log('', 'info');
        log('üéâ –ì–û–¢–û–í–û! –í—Å–µ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã!', 'success');
        log(`üìã –°–æ–∑–¥–∞–Ω–æ: Pipeline (1), –≠—Ç–∞–ø–æ–≤ (${stages.length}), –°–¥–µ–ª–æ–∫ (${TEST_DEALS.length})`, 'info');
        log('üåê –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É "–°–¥–µ–ª–∫–∏" —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç', 'info');
        
        createBtn.textContent = '‚úì –î–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω—ã';
        createBtn.style.background = '#48bb78';
        
      } catch (error) {
        log(`‚ùå –û–®–ò–ë–ö–ê: ${error.message}`, 'error');
        
        if (error.message.includes('access_token')) {
          log('üîê –†–µ—à–µ–Ω–∏–µ: –í–æ–π–¥–∏—Ç–µ –≤ CRM —Å–∏—Å—Ç–µ–º—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞', 'error');
        } else if (error.message.includes('401') || error.message.includes('403')) {
          log('üîê –ü–æ—Ö–æ–∂–µ, –≤–∞—à —Ç–æ–∫–µ–Ω —É—Å—Ç–∞—Ä–µ–ª. –í–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.', 'error');
        }
        
        createBtn.disabled = false;
        createBtn.textContent = '–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞';
      }
    }
  </script>
</body>
</html>

