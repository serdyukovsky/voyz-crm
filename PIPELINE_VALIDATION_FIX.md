# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —É—Å–ª–æ–≤–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏–º–ø–æ—Ä—Ç–∞

## üîß –ü—Ä–æ–±–ª–µ–º–∞

**–ë—ã–ª–æ**: –£—Å–ª–æ–≤–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ `finalWorkspaceId` (–∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç):
```typescript
if (finalWorkspaceId || pipeline) {
  // import
} else {
  summary.failed += validRows.length;
}
```

**–ü—Ä–æ–±–ª–µ–º–∞**: 
- ‚ùå `finalWorkspaceId` –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª
- ‚ùå –£—Å–ª–æ–≤–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–æ –∏–º–ø–æ—Ä—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚ùå Workspace –Ω–µ –¥–æ–ª–∂–µ–Ω —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –ª–æ–≥–∏–∫–µ

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

**–°—Ç–∞–ª–æ**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ pipeline (workspace —É–¥–∞–ª–µ–Ω):
```typescript
// CRITICAL: Pipeline is REQUIRED for import
// If pipeline is not found, abort import immediately
if (!pipeline) {
  const errorMessage = 'Pipeline could not be resolved. Import aborted.';
  console.error('[IMPORT DEALS ERROR]', errorMessage, { pipelineId });
  if (dryRun) {
    globalErrors.push(errorMessage);
    summary.failed = validRows.length;
    // Mark all rows as failed
    validRows.forEach((row, index) => {
      errors.push({
        row: index + 1,
        error: errorMessage,
      });
    });
  } else {
    throw new Error(errorMessage);
  }
}
```

## üìç –ú–µ—Å—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 1. **–ü–µ—Ä–µ–¥ dry-run** (—Å—Ç—Ä–æ–∫–∞ ~1280)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `if (!pipeline)` –ø–µ—Ä–µ–¥ dry-run
- ‚úÖ –í dry-run: –¥–æ–±–∞–≤–ª—è–µ—Ç –æ—à–∏–±–∫–∏ –≤ `globalErrors` –∏ –ø–æ–º–µ—á–∞–µ—Ç –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –∫–∞–∫ failed
- ‚úÖ –ù–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ (dry-run –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 200)

### 2. **–ü–µ—Ä–µ–¥ actual import** (—Å—Ç—Ä–æ–∫–∞ ~1455)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `if (!pipeline)` –ø–µ—Ä–µ–¥ actual import
- ‚úÖ –í actual import: –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç `Error('Pipeline could not be resolved. Import aborted.')`
- ‚úÖ –ò–º–ø–æ—Ä—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –µ—Å–ª–∏ pipeline –Ω–µ –Ω–∞–π–¥–µ–Ω

## ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã

1. ‚úÖ **–£–¥–∞–ª–µ–Ω workspaceId** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ `pipeline`
2. ‚úÖ **–ó–∞–ø—Ä–µ—â–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ workspace** - –Ω–µ—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏–π `finalWorkspaceId` –∏–ª–∏ `workspaceId`
3. ‚úÖ **REQUIRED –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
   - `userId` - –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω (–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è —Ä–∞–Ω–µ–µ)
   - `pipelineId` - –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω (pipeline –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞–π–¥–µ–Ω)
   - `stageId` - –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏
   - `title` - –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏
4. ‚úÖ **–õ–æ–≥–∏–∫–∞ pipeline**: –ï—Å–ª–∏ pipeline –Ω–∞–π–¥–µ–Ω ‚Üí –∏–º–ø–æ—Ä—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –∏–º–ø–æ—Ä—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω.

## üîç –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### Dry-run —Ä–µ–∂–∏–º:
1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è pipeline –ø–æ `pipelineId`
2. –ï—Å–ª–∏ pipeline –Ω–µ –Ω–∞–π–¥–µ–Ω:
   - –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–∫–∞ –≤ `globalErrors`
   - –í—Å–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ failed
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å –æ—à–∏–±–∫–∞–º–∏ (200 OK)

### Actual import —Ä–µ–∂–∏–º:
1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è pipeline –ø–æ `pipelineId`
2. –ï—Å–ª–∏ pipeline –Ω–µ –Ω–∞–π–¥–µ–Ω:
   - –í—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è `Error('Pipeline could not be resolved. Import aborted.')`
   - –ò–º–ø–æ—Ä—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 500 –æ—à–∏–±–∫–∞

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

**Workspace –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω –∏–∑ –ª–æ–≥–∏–∫–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.**

–ò–º–ø–æ—Ä—Ç —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å pipeline:
- ‚úÖ –ï—Å–ª–∏ pipeline –Ω–∞–π–¥–µ–Ω ‚Üí –∏–º–ø–æ—Ä—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω
- ‚ùå –ï—Å–ª–∏ pipeline –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –∏–º–ø–æ—Ä—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
- ‚úÖ Workspace –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –ª–æ–≥–∏–∫–µ







