# Performance Audit - Prisma Schema
## –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è CRM —Å –º–∞—Å—Å–æ–≤—ã–º –∏–º–ø–æ—Ä—Ç–æ–º CSV

---

## 1. –ê–ù–ê–õ–ò–ó –ß–ê–°–¢–û–¢–´ –û–ü–ï–†–ê–¶–ò–ô

### 1.1 –ú–æ–¥–µ–ª–∏ - –ß–∞—Å—Ç–æ—Ç–∞ —á—Ç–µ–Ω–∏—è (READ)

| –ú–æ–¥–µ–ª—å | –ß–∞—Å—Ç–æ—Ç–∞ —á—Ç–µ–Ω–∏—è | –¢–∏–ø–∏—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å –∏–Ω–¥–µ–∫—Å–æ–≤ |
|--------|---------------|------------------|---------------------|
| **Deal** | üî¥ –û–ß–ï–ù–¨ –í–´–°–û–ö–ê–Ø | –°–ø–∏—Å–æ–∫ —Å–¥–µ–ª–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏, –¥–µ—Ç–∞–ª–∏ —Å–¥–µ–ª–∫–∏, –¥–∞—à–±–æ—Ä–¥—ã | –ö–†–ò–¢–ò–ß–ù–û |
| **Contact** | üî¥ –û–ß–ï–ù–¨ –í–´–°–û–ö–ê–Ø | –ü–æ–∏—Å–∫ –ø–æ email/phone, —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤, –∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç | –ö–†–ò–¢–ò–ß–ù–û |
| **Company** | üü° –í–´–°–û–ö–ê–Ø | –ü–æ–∏—Å–∫ –ø–æ name, —Å–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π, –¥–µ—Ç–∞–ª–∏ | –í–ê–ñ–ù–û |
| **Task** | üü° –í–´–°–û–ö–ê–Ø | –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∑–∞–¥–∞—á–∏ –ø–æ —Å–¥–µ–ª–∫–µ | –í–ê–ñ–ù–û |
| **Activity** | üü° –í–´–°–û–ö–ê–Ø | –ò—Å—Ç–æ—Ä–∏—è –ø–æ —Å–¥–µ–ª–∫–µ/–∫–æ–Ω—Ç–∞–∫—Ç—É, timeline | –í–ê–ñ–ù–û |
| **CustomFieldValue** | üü° –°–†–ï–î–ù–Ø–Ø | –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–µ–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—É—â–Ω–æ—Å—Ç–∏ | –°–†–ï–î–ù–ï |
| **Comment** | üü¢ –°–†–ï–î–ù–Ø–Ø | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ —Å–¥–µ–ª–∫–µ/–∑–∞–¥–∞—á–µ | –°–†–ï–î–ù–ï |
| **File** | üü¢ –ù–ò–ó–ö–ê–Ø | –§–∞–π–ª—ã –ø–æ —Å—É—â–Ω–æ—Å—Ç–∏ | –ù–ò–ó–ö–û |
| **Message** | üü¢ –ù–ò–ó–ö–ê–Ø | –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ —Å–¥–µ–ª–∫–µ | –ù–ò–ó–ö–û |
| **Call** | üü¢ –ù–ò–ó–ö–ê–Ø | –ó–≤–æ–Ω–∫–∏ –ø–æ —Å–¥–µ–ª–∫–µ | –ù–ò–ó–ö–û |

**–í—ã–≤–æ–¥**: Deal –∏ Contact —Ç—Ä–µ–±—É—é—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏–Ω–¥–µ–∫—Å–æ–≤.

---

### 1.2 –ú–æ–¥–µ–ª–∏ - –ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (UPDATE)

| –ú–æ–¥–µ–ª—å | –ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è | –¢–∏–ø–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
|--------|-------------------|-------------------|-------------|
| **Deal** | üî¥ –û–ß–ï–ù–¨ –í–´–°–û–ö–ê–Ø | –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞–¥–∏–∏, —Å—É–º–º—ã, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ, –∑–∞–∫—Ä—ã—Ç–∏–µ | –ö–†–ò–¢–ò–ß–ù–û |
| **Contact** | üî¥ –í–´–°–û–ö–ê–Ø | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, —Å–≤—è–∑—å —Å –∫–æ–º–ø–∞–Ω–∏–µ–π | –í–ê–ñ–ù–û |
| **Task** | üü° –í–´–°–û–ö–ê–Ø | –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ | –í–ê–ñ–ù–û |
| **Activity** | üü¢ –¢–û–õ–¨–ö–û INSERT | –¢–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π | –ù–ò–ó–ö–û |
| **CustomFieldValue** | üü° –°–†–ï–î–ù–Ø–Ø | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ–ª–µ–π | –°–†–ï–î–ù–ï |
| **Comment** | üü¢ –ù–ò–ó–ö–ê–Ø | –†–µ–¥–∫–∏–µ –ø—Ä–∞–≤–∫–∏ | –ù–ò–ó–ö–û |

**–í—ã–≤–æ–¥**: Deal –∏ Contact —Ç—Ä–µ–±—É—é—Ç –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ `updatedAt` –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –ø–æ—Å–ª–µ–¥–Ω–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è–º.

---

### 1.3 –ú–æ–¥–µ–ª–∏ - –ü–æ–∏—Å–∫ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ CSV (10k-100k —Å—Ç—Ä–æ–∫)

| –ú–æ–¥–µ–ª—å | –ö—Ä–∏—Ç–µ—Ä–∏–π –ø–æ–∏—Å–∫–∞ | –ß–∞—Å—Ç–æ—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ | –¢–µ–∫—É—â–∏–π –∏–Ω–¥–µ–∫—Å | –ü—Ä–æ–±–ª–µ–º–∞ |
|--------|----------------|-----------------|----------------|----------|
| **Contact** | `email` | –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ CSV | ‚úÖ –ï—Å—Ç—å | ‚ùå –ù–µ—Ç @unique ‚Üí –≤–æ–∑–º–æ–∂–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã |
| **Contact** | `phone` | –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ CSV | ‚úÖ –ï—Å—Ç—å | ‚ùå –ù–µ—Ç @unique ‚Üí –≤–æ–∑–º–æ–∂–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã |
| **Company** | `name` | –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ CSV | ‚úÖ –ï—Å—Ç—å | ‚ùå –ù–µ—Ç @unique ‚Üí –≤–æ–∑–º–æ–∂–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã |
| **Company** | `email` | –†–µ–¥–∫–æ | ‚úÖ –ï—Å—Ç—å | ‚ùå –ù–µ—Ç @unique |
| **Deal** | `number` | –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ CSV | ‚úÖ @unique | ‚úÖ OK |
| **Contact** | `companyName` | –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ CSV | ‚úÖ –ï—Å—Ç—å | ‚ö†Ô∏è –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è, –Ω–æ –Ω—É–∂–µ–Ω –¥–ª—è –ø–æ–∏—Å–∫–∞ |

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô BOTTLENECK**: –ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ CSV –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è:
1. `SELECT * FROM contacts WHERE email = ?` (–∏–ª–∏ phone)
2. `SELECT * FROM companies WHERE name = ?`
3. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ ‚Üí INSERT, –∏–Ω–∞—á–µ UPDATE

**–ë–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤**: O(n¬≤) —Å–ª–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ 100k —Å—Ç—Ä–æ–∫.

---

## 2. –ê–ù–ê–õ–ò–ó –ò–ù–î–ï–ö–°–û–í

### 2.1 Deal Model - –ê–Ω–∞–ª–∏–∑ –∏–Ω–¥–µ–∫—Å–æ–≤

**–¢–µ–∫—É—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã:**
```prisma
@@index([pipelineId])
@@index([stageId])
@@index([assignedToId])
@@index([createdById])
@@index([contactId])
@@index([createdAt])
```

**–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:**

1. ‚ùå **`companyId`** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–≤—è–∑—è—Ö, –Ω–æ –Ω–µ—Ç –∏–Ω–¥–µ–∫—Å–∞
   - **–ó–∞–ø—Ä–æ—Å**: `SELECT * FROM deals WHERE company_id = ?`
   - **–ß–∞—Å—Ç–æ—Ç–∞**: –í—ã—Å–æ–∫–∞—è (—Å–ø–∏—Å–æ–∫ —Å–¥–µ–ª–æ–∫ –∫–æ–º–ø–∞–Ω–∏–∏)
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üî¥ –ö–†–ò–¢–ò–ß–ù–û

2. ‚ùå **`updatedAt`** ‚Äî –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –ø–æ—Å–ª–µ–¥–Ω–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è–º
   - **–ó–∞–ø—Ä–æ—Å**: `SELECT * FROM deals ORDER BY updated_at DESC`
   - **–ß–∞—Å—Ç–æ—Ç–∞**: –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è (–¥–∞—à–±–æ—Ä–¥—ã, —Å–ø–∏—Å–∫–∏)
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üî¥ –ö–†–ò–¢–ò–ß–ù–û

3. ‚ùå **`expectedCloseAt`** ‚Äî –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –¥–∞—Ç–∞–º –∑–∞–∫—Ä—ã—Ç–∏—è
   - **–ó–∞–ø—Ä–æ—Å**: `SELECT * FROM deals WHERE expected_close_at BETWEEN ? AND ?`
   - **–ß–∞—Å—Ç–æ—Ç–∞**: –í—ã—Å–æ–∫–∞—è (–æ—Ç—á–µ—Ç—ã, –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è)
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üü° –í–ê–ñ–ù–û

4. ‚ùå **`closedAt`** ‚Äî –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∑–∞–∫—Ä—ã—Ç—ã—Ö —Å–¥–µ–ª–æ–∫
   - **–ó–∞–ø—Ä–æ—Å**: `SELECT * FROM deals WHERE closed_at IS NOT NULL`
   - **–ß–∞—Å—Ç–æ—Ç–∞**: –í—ã—Å–æ–∫–∞—è (–æ—Ç—á–µ—Ç—ã)
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üü° –í–ê–ñ–ù–û

5. ‚ùå **`amount`** ‚Äî –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏/—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Å—É–º–º–µ
   - **–ó–∞–ø—Ä–æ—Å**: `SELECT * FROM deals ORDER BY amount DESC`
   - **–ß–∞—Å—Ç–æ—Ç–∞**: –í—ã—Å–æ–∫–∞—è (–¥–∞—à–±–æ—Ä–¥—ã, –æ—Ç—á–µ—Ç—ã)
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üü° –í–ê–ñ–ù–û

6. ‚ùå **Composite: `[pipelineId, stageId]`** ‚Äî —Å–∞–º—ã–π —á–∞—Å—Ç—ã–π –∑–∞–ø—Ä–æ—Å
   - **–ó–∞–ø—Ä–æ—Å**: `SELECT * FROM deals WHERE pipeline_id = ? AND stage_id = ?`
   - **–ß–∞—Å—Ç–æ—Ç–∞**: –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è (–∫–∞–Ω–±–∞–Ω-–¥–æ—Å–∫–∏, —Ñ–∏–ª—å—Ç—Ä—ã)
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üî¥ –ö–†–ò–¢–ò–ß–ù–û

7. ‚ùå **Composite: `[assignedToId, stageId]`** ‚Äî —á–∞—Å—Ç—ã–π –∑–∞–ø—Ä–æ—Å
   - **–ó–∞–ø—Ä–æ—Å**: `SELECT * FROM deals WHERE assigned_to_id = ? AND stage_id = ?`
   - **–ß–∞—Å—Ç–æ—Ç–∞**: –í—ã—Å–æ–∫–∞—è (–ª–∏—á–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã)
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üü° –í–ê–ñ–ù–û

8. ‚ùå **Composite: `[pipelineId, stageId, assignedToId]`** ‚Äî –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
   - **–ó–∞–ø—Ä–æ—Å**: `SELECT * FROM deals WHERE pipeline_id = ? AND stage_id = ? AND assigned_to_id = ?`
   - **–ß–∞—Å—Ç–æ—Ç–∞**: –°—Ä–µ–¥–Ω—è—è (–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã)
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üü¢ –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û

9. ‚ùå **Partial: `WHERE closed_at IS NULL`** ‚Äî –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–¥–µ–ª–æ–∫
   - **–ó–∞–ø—Ä–æ—Å**: `SELECT * FROM deals WHERE closed_at IS NULL AND ...`
   - **–ß–∞—Å—Ç–æ—Ç–∞**: –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è (–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤)
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üü° –í–ê–ñ–ù–û (—á–µ—Ä–µ–∑ raw SQL)

---

### 2.2 Contact Model - –ê–Ω–∞–ª–∏–∑ –∏–Ω–¥–µ–∫—Å–æ–≤

**–¢–µ–∫—É—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã:**
```prisma
@@index([email])
@@index([phone])
@@index([companyName])
@@index([companyId])
@@index([createdAt])
@@index([fullName])
@@index([email, phone]) // Composite
```

**–ü—Ä–æ–±–ª–µ–º—ã:**

1. ‚ùå **–ù–µ—Ç `@unique` –Ω–∞ `email`** ‚Äî –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –≤–æ–∑–º–æ–∂–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã
   - **–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ 100k —Å—Ç—Ä–æ–∫ –±–µ–∑ unique constraint –≤–æ–∑–º–æ–∂–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üî¥ –ö–†–ò–¢–ò–ß–ù–û –¥–ª—è data integrity

2. ‚ùå **–ù–µ—Ç `@unique` –Ω–∞ `phone`** ‚Äî –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –≤–æ–∑–º–æ–∂–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üî¥ –ö–†–ò–¢–ò–ß–ù–û –¥–ª—è data integrity

3. ‚ùå **–ù–µ—Ç –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ `updatedAt`** ‚Äî –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üü° –í–ê–ñ–ù–û

4. ‚ö†Ô∏è **GIN –∏–Ω–¥–µ–∫—Å –Ω–∞ `tags`** ‚Äî –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ —Ç–µ–≥–∞–º
   - **–ó–∞–ø—Ä–æ—Å**: `SELECT * FROM contacts WHERE 'tag' = ANY(tags)`
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üü¢ –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û (—á–µ—Ä–µ–∑ raw SQL)

5. ‚ö†Ô∏è **Composite: `[companyId, email]`** ‚Äî –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –≤ –∫–æ–º–ø–∞–Ω–∏–∏
   - **–ó–∞–ø—Ä–æ—Å**: `SELECT * FROM contacts WHERE company_id = ? AND email = ?`
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üü¢ –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û

---

### 2.3 Company Model - –ê–Ω–∞–ª–∏–∑ –∏–Ω–¥–µ–∫—Å–æ–≤

**–¢–µ–∫—É—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã:**
```prisma
@@index([name])
@@index([industry])
@@index([email])
@@index([createdAt])
```

**–ü—Ä–æ–±–ª–µ–º—ã:**

1. ‚ùå **–ù–µ—Ç `@unique` –Ω–∞ `name`** ‚Äî –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –≤–æ–∑–º–æ–∂–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üî¥ –ö–†–ò–¢–ò–ß–ù–û –¥–ª—è data integrity

2. ‚ùå **–ù–µ—Ç `@unique` –Ω–∞ `email`** ‚Äî –≤–æ–∑–º–æ–∂–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üü° –í–ê–ñ–ù–û

3. ‚ùå **–ù–µ—Ç –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ `phone`** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–∏—Å–∫–∞
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üü° –í–ê–ñ–ù–û

4. ‚ùå **–ù–µ—Ç –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ `updatedAt`** ‚Äî –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üü° –í–ê–ñ–ù–û

---

### 2.4 Task Model - –ê–Ω–∞–ª–∏–∑ –∏–Ω–¥–µ–∫—Å–æ–≤

**–¢–µ–∫—É—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã:**
```prisma
@@index([dealId])
@@index([contactId])
@@index([assignedToId])
@@index([status])
@@index([deadline])
@@index([type])
```

**–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ:**

1. ‚ùå **`createdById`** ‚Äî –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üü° –í–ê–ñ–ù–û

2. ‚ùå **`createdAt`** ‚Äî –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üü° –í–ê–ñ–ù–û

3. ‚ùå **Composite: `[assignedToId, status]`** ‚Äî —á–∞—Å—Ç—ã–π –∑–∞–ø—Ä–æ—Å
   - **–ó–∞–ø—Ä–æ—Å**: `SELECT * FROM tasks WHERE assigned_to_id = ? AND status = ?`
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üü° –í–ê–ñ–ù–û

4. ‚ùå **Composite: `[dealId, status]`** ‚Äî –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∑–∞–¥–∞—á –ø–æ —Å–¥–µ–ª–∫–µ
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üü¢ –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û

5. ‚ùå **Partial: `WHERE deadline IS NOT NULL AND deadline < NOW()`** ‚Äî –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üü° –í–ê–ñ–ù–û (—á–µ—Ä–µ–∑ raw SQL)

---

### 2.5 Activity Model - –ê–Ω–∞–ª–∏–∑ –∏–Ω–¥–µ–∫—Å–æ–≤

**–¢–µ–∫—É—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã:**
```prisma
@@index([dealId])
@@index([taskId])
@@index([contactId])
@@index([userId])
@@index([type])
@@index([createdAt])
```

**–ü—Ä–æ–±–ª–µ–º—ã:**

1. ‚ùå **Composite: `[dealId, createdAt]`** ‚Äî –¥–ª—è timeline –ø–æ —Å–¥–µ–ª–∫–µ
   - **–ó–∞–ø—Ä–æ—Å**: `SELECT * FROM activities WHERE deal_id = ? ORDER BY created_at DESC`
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üü° –í–ê–ñ–ù–û (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –ø–æ–ª—é)

2. ‚ùå **Composite: `[contactId, createdAt]`** ‚Äî –¥–ª—è timeline –ø–æ –∫–æ–Ω—Ç–∞–∫—Ç—É
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üü° –í–ê–ñ–ù–û

3. ‚ùå **Composite: `[type, createdAt]`** ‚Äî –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ç–∏–ø—É –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üü¢ –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û

---

### 2.6 CustomFieldValue Model - –ê–Ω–∞–ª–∏–∑ –∏–Ω–¥–µ–∫—Å–æ–≤

**–¢–µ–∫—É—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã:**
```prisma
@@unique([customFieldId, dealId])
@@unique([customFieldId, contactId])
@@index([customFieldId])
@@index([dealId])
@@index([contactId])
@@index([entityType, entityId])
```

**–ü—Ä–æ–±–ª–µ–º—ã:**

1. ‚ùå **Composite: `[dealId, customFieldId]`** ‚Äî –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–¥–µ–ª–∫–∏
   - **–ó–∞–ø—Ä–æ—Å**: `SELECT * FROM custom_field_values WHERE deal_id = ?`
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üü° –í–ê–ñ–ù–û (—É–∂–µ –ø–æ–∫—Ä—ã—Ç–æ unique, –Ω–æ –º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å)

2. ‚ö†Ô∏è **GIN –∏–Ω–¥–µ–∫—Å –Ω–∞ `value` (JSONB)** ‚Äî –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –∑–Ω–∞—á–µ–Ω–∏—è–º
   - **–ó–∞–ø—Ä–æ—Å**: `SELECT * FROM custom_field_values WHERE value @> '{"key": "value"}'`
   - **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üü¢ –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –ø–æ–∏—Å–∫ –ø–æ JSON)

---

## 3. –î–û–†–û–ì–ò–ï –ó–ê–ü–†–û–°–´ –ò BOTTLENECK'–ò

### 3.1 –ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ CSV (10k-100k —Å—Ç—Ä–æ–∫)

#### Bottleneck #1: –ü–æ–∏—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö Contact –ø–æ email/phone

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
```sql
-- –î–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ CSV (100k —Ä–∞–∑):
SELECT * FROM contacts WHERE email = ? OR phone = ?
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –ù–µ—Ç composite index –Ω–∞ `[email, phone]` –¥–ª—è OR –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚ùå –ù–µ—Ç `@unique` ‚Üí –≤–æ–∑–º–æ–∂–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã
- ‚ö†Ô∏è OR –∑–∞–ø—Ä–æ—Å—ã –º–µ–¥–ª–µ–Ω–Ω–µ–µ, —á–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞: `WHERE email = ?` –∏ `WHERE phone = ?`
2. –î–æ–±–∞–≤–∏—Ç—å `@unique` –Ω–∞ –æ–±–∞ –ø–æ–ª—è
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `findFirst` –≤–º–µ—Å—Ç–æ `findMany`

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- –ë–µ–∑ –∏–Ω–¥–µ–∫—Å–∞: ~100ms –Ω–∞ –∑–∞–ø—Ä–æ—Å √ó 100k = 10,000 —Å–µ–∫—É–Ω–¥ (2.7 —á–∞—Å–∞)
- –° –∏–Ω–¥–µ–∫—Å–æ–º: ~1ms –Ω–∞ –∑–∞–ø—Ä–æ—Å √ó 100k = 100 —Å–µ–∫—É–Ω–¥ (1.6 –º–∏–Ω—É—Ç—ã)
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ: 100x**

---

#### Bottleneck #2: –ü–æ–∏—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö Company –ø–æ name

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
```sql
-- –î–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ CSV (100k —Ä–∞–∑):
SELECT * FROM companies WHERE name = ?
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –ù–µ—Ç `@unique` ‚Üí –≤–æ–∑–º–æ–∂–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã
- ‚úÖ –ï—Å—Ç—å –∏–Ω–¥–µ–∫—Å, –Ω–æ –±–µ–∑ unique constraint

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- –° –∏–Ω–¥–µ–∫—Å–æ–º: ~1ms √ó 100k = 100 —Å–µ–∫—É–Ω–¥
- **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: –°—Ä–µ–¥–Ω—è—è (–∫–æ–º–ø–∞–Ω–∏–π –º–µ–Ω—å—à–µ, —á–µ–º –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤)

---

#### Bottleneck #3: JOIN –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ Deal —Å Contact/Company

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
```sql
SELECT d.*, c.*, co.* 
FROM deals d
LEFT JOIN contacts c ON d.contact_id = c.id
LEFT JOIN companies co ON d.company_id = co.id
WHERE d.pipeline_id = ? AND d.stage_id = ?
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –ù–µ—Ç composite index –Ω–∞ `[pipelineId, stageId]` –≤ Deal
- ‚úÖ –ï—Å—Ç—å –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ FK, –Ω–æ composite –±—ã—Å—Ç—Ä–µ–µ

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- –ë–µ–∑ composite: ~50ms –Ω–∞ –∑–∞–ø—Ä–æ—Å
- –° composite: ~5ms –Ω–∞ –∑–∞–ø—Ä–æ—Å
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ: 10x**

---

#### Bottleneck #4: –ó–∞–≥—Ä—É–∑–∫–∞ CustomFieldValue –¥–ª—è Deal

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
```sql
-- –î–ª—è –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–∏ (N+1 –ø—Ä–æ–±–ª–µ–º–∞):
SELECT * FROM custom_field_values WHERE deal_id = ?
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚úÖ –ï—Å—Ç—å –∏–Ω–¥–µ–∫—Å –Ω–∞ `dealId`
- ‚ö†Ô∏è N+1 –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞ —Å–¥–µ–ª–æ–∫

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `include` –≤ Prisma: `deals: { include: { customFieldValues: true } }`
- Batch loading: `WHERE deal_id IN (?, ?, ...)`

---

### 3.2 –ü—Ä–∏ –æ–±—ã—á–Ω–æ–π —Ä–∞–±–æ—Ç–µ (—á—Ç–µ–Ω–∏–µ)

#### –î–æ—Ä–æ–≥–æ–π –∑–∞–ø—Ä–æ—Å #1: –°–ø–∏—Å–æ–∫ —Å–¥–µ–ª–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
```sql
SELECT * FROM deals 
WHERE pipeline_id = ? 
  AND stage_id = ? 
  AND assigned_to_id = ?
  AND closed_at IS NULL
ORDER BY updated_at DESC
LIMIT 50
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –ù–µ—Ç composite index –Ω–∞ `[pipelineId, stageId, assignedToId]`
- ‚ùå –ù–µ—Ç –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ `updatedAt`
- ‚ùå –ù–µ—Ç partial index –Ω–∞ `closed_at IS NULL`

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- –ë–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏: ~200ms
- –° –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π: ~10ms
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ: 20x**

---

#### –î–æ—Ä–æ–≥–æ–π –∑–∞–ø—Ä–æ—Å #2: Timeline –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ —Å–¥–µ–ª–∫–µ

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
```sql
SELECT * FROM activities 
WHERE deal_id = ? 
ORDER BY created_at DESC
LIMIT 100
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚úÖ –ï—Å—Ç—å –∏–Ω–¥–µ–∫—Å –Ω–∞ `dealId`
- ‚úÖ –ï—Å—Ç—å –∏–Ω–¥–µ–∫—Å –Ω–∞ `createdAt`
- ‚ùå –ù–µ—Ç composite index –Ω–∞ `[dealId, createdAt]` –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- –ë–µ–∑ composite: ~30ms
- –° composite: ~5ms
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ: 6x**

---

#### –î–æ—Ä–æ–≥–æ–π –∑–∞–ø—Ä–æ—Å #3: –ü–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
```sql
SELECT * FROM contacts 
WHERE company_id = ?
  AND (email LIKE ? OR phone LIKE ? OR full_name LIKE ?)
ORDER BY updated_at DESC
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚úÖ –ï—Å—Ç—å –∏–Ω–¥–µ–∫—Å –Ω–∞ `companyId`
- ‚ùå –ù–µ—Ç –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ `updatedAt`
- ‚ö†Ô∏è LIKE –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏–Ω–¥–µ–∫—Å—ã —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ (–Ω—É–∂–µ–Ω full-text search)

---

## 4. –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–ù–î–ï–ö–°–ê–ú

### 4.1 –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å)

#### Deal Model:
```prisma
model Deal {
  // ... existing fields ...

  @@index([companyId])                    // –ö–†–ò–¢–ò–ß–ù–û: –¥–ª—è —Å–≤—è–∑–µ–π
  @@index([updatedAt])                     // –ö–†–ò–¢–ò–ß–ù–û: –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
  @@index([expectedCloseAt])              // –í–ê–ñ–ù–û: –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
  @@index([closedAt])                     // –í–ê–ñ–ù–û: –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
  @@index([amount])                        // –í–ê–ñ–ù–û: –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
  @@index([pipelineId, stageId])           // –ö–†–ò–¢–ò–ß–ù–û: —Å–∞–º—ã–π —á–∞—Å—Ç—ã–π –∑–∞–ø—Ä–æ—Å
  @@index([assignedToId, stageId])         // –í–ê–ñ–ù–û: –¥–ª—è –¥–∞—à–±–æ—Ä–¥–æ–≤
  @@index([pipelineId, stageId, assignedToId]) // –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û: –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
}
```

#### Contact Model:
```prisma
model Contact {
  email     String?  @unique  // –ö–†–ò–¢–ò–ß–ù–û: –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
  phone     String?  @unique  // –ö–†–ò–¢–ò–ß–ù–û: –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
  
  // ... existing fields ...

  @@index([updatedAt])                     // –í–ê–ñ–ù–û: –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
}
```

#### Company Model:
```prisma
model Company {
  name      String   @unique  // –ö–†–ò–¢–ò–ß–ù–û: –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
  email     String?  @unique  // –í–ê–ñ–ù–û: –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
  
  // ... existing fields ...

  @@index([phone])                         // –í–ê–ñ–ù–û: –¥–ª—è –ø–æ–∏—Å–∫–∞
  @@index([updatedAt])                     // –í–ê–ñ–ù–û: –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
}
```

#### Task Model:
```prisma
model Task {
  // ... existing fields ...

  @@index([createdById])                   // –í–ê–ñ–ù–û: –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
  @@index([createdAt])                     // –í–ê–ñ–ù–û: –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
  @@index([assignedToId, status])          // –í–ê–ñ–ù–û: —á–∞—Å—Ç—ã–π –∑–∞–ø—Ä–æ—Å
}
```

#### Activity Model:
```prisma
model Activity {
  // ... existing fields ...

  @@index([dealId, createdAt])             // –í–ê–ñ–ù–û: –¥–ª—è timeline
  @@index([contactId, createdAt])         // –í–ê–ñ–ù–û: –¥–ª—è timeline
}
```

---

### 4.2 –û–ü–¶–ò–û–ù–ê–õ–¨–ù–´–ï (–¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)

#### GIN –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –º–∞—Å—Å–∏–≤–æ–≤ (—á–µ—Ä–µ–∑ raw SQL):
```sql
-- –î–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ —Ç–µ–≥–∞–º
CREATE INDEX contacts_tags_gin ON contacts USING GIN (tags);
CREATE INDEX deals_tags_gin ON deals USING GIN (tags);
```

#### Partial –∏–Ω–¥–µ–∫—Å—ã (—á–µ—Ä–µ–∑ raw SQL):
```sql
-- –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–¥–µ–ª–∫–∏ (–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤)
CREATE INDEX deals_active ON deals (pipeline_id, stage_id, assigned_to_id) 
WHERE closed_at IS NULL;

-- –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
CREATE INDEX tasks_overdue ON tasks (assigned_to_id, deadline) 
WHERE deadline IS NOT NULL AND deadline < NOW() AND status != 'DONE';

-- –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω default pipeline
CREATE UNIQUE INDEX pipelines_single_default ON pipelines (is_default) 
WHERE is_default = true;
```

#### JSONB –∏–Ω–¥–µ–∫—Å—ã (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –ø–æ–∏—Å–∫ –ø–æ JSON):
```sql
-- –î–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ custom field values
CREATE INDEX custom_field_values_value_gin ON custom_field_values 
USING GIN (value jsonb_path_ops);
```

---

## 5. –î–ï–ù–û–†–ú–ê–õ–ò–ó–ê–¶–ò–Ø

### 5.1 –¢–µ–∫—É—â–∞—è –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è

**Contact.companyName:**
- ‚úÖ **–û—Å—Ç–∞–≤–∏—Ç—å** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ
- ‚ö†Ô∏è –ù–æ –Ω—É–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å `Company.name` –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```prisma
model Contact {
  companyName String? // –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
  companyId   String?
  
  // –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ Company.name ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ Contact.companyName
  // –≠—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —á–µ—Ä–µ–∑ —Ç—Ä–∏–≥–≥–µ—Ä—ã –∏–ª–∏ application-level –ª–æ–≥–∏–∫—É
}
```

---

### 5.2 –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è

#### Deal: –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å stage.name –∏ pipeline.name

**–ü—Ä–æ–±–ª–µ–º–∞:**
```sql
-- –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞ —Å–¥–µ–ª–æ–∫ –Ω—É–∂–µ–Ω JOIN:
SELECT d.*, s.name as stage_name, p.name as pipeline_name
FROM deals d
JOIN stages s ON d.stage_id = s.id
JOIN pipelines p ON d.pipeline_id = p.id
```

**–†–µ—à–µ–Ω–∏–µ:**
```prisma
model Deal {
  // ... existing fields ...
  
  // –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è JOIN
  stageName     String?  // –ö–æ–ø–∏—è Stage.name
  pipelineName  String?  // –ö–æ–ø–∏—è Pipeline.name
  
  // –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ Stage.name ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ Deal.stageName
  // –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ Pipeline.name ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ Deal.pipelineName
}
```

**–í—ã–≥–æ–¥–∞:**
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å–ø–∏—Å–∫–∞ —Å–¥–µ–ª–æ–∫: ~50ms ‚Üí ~5ms (10x)
- –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ JOIN –æ–ø–µ—Ä–∞—Ü–∏–∏

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ù—É–∂–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ Stage/Pipeline
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –≤ –ë–î

---

#### Deal: –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å contact.fullName –∏ company.name

**–ü—Ä–æ–±–ª–µ–º–∞:**
```sql
-- –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞ —Å–¥–µ–ª–æ–∫ –Ω—É–∂–µ–Ω JOIN:
SELECT d.*, c.full_name as contact_name, co.name as company_name
FROM deals d
LEFT JOIN contacts c ON d.contact_id = c.id
LEFT JOIN companies co ON d.company_id = co.id
```

**–†–µ—à–µ–Ω–∏–µ:**
```prisma
model Deal {
  // ... existing fields ...
  
  contactName  String?  // –ö–æ–ø–∏—è Contact.fullName
  companyName  String?  // –ö–æ–ø–∏—è Company.name
  
  // –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ Contact.fullName ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ Deal.contactName
  // –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ Company.name ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ Deal.companyName
}
```

**–í—ã–≥–æ–¥–∞:**
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å–ø–∏—Å–∫–∞ —Å–¥–µ–ª–æ–∫: ~30ms ‚Üí ~5ms (6x)
- –ú–µ–Ω—å—à–µ JOIN –æ–ø–µ—Ä–∞—Ü–∏–π

---

#### Activity: –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å user.firstName + lastName

**–ü—Ä–æ–±–ª–µ–º–∞:**
```sql
-- –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ timeline –Ω—É–∂–µ–Ω JOIN:
SELECT a.*, u.first_name, u.last_name
FROM activities a
JOIN users u ON a.user_id = u.id
```

**–†–µ—à–µ–Ω–∏–µ:**
```prisma
model Activity {
  // ... existing fields ...
  
  userName     String?  // –ö–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è User.firstName + User.lastName
  
  // –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Activity ‚Üí –∑–∞–ø–æ–ª–Ω–∏—Ç—å userName
}
```

**–í—ã–≥–æ–¥–∞:**
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ timeline: ~20ms ‚Üí ~3ms (6x)

---

## 6. SUMMARY - –ü–†–ò–û–†–ò–¢–ï–¢–´

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï (–ø—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ):

1. **Deal**: –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ `companyId`, `updatedAt`, `[pipelineId, stageId]`
2. **Contact**: –î–æ–±–∞–≤–∏—Ç—å `@unique` –Ω–∞ `email` –∏ `phone`
3. **Company**: –î–æ–±–∞–≤–∏—Ç—å `@unique` –Ω–∞ `name` –∏ `email`, –∏–Ω–¥–µ–∫—Å –Ω–∞ `phone`
4. **Task**: –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ `createdById`, `createdAt`, `[assignedToId, status]`
5. **Activity**: –î–æ–±–∞–≤–∏—Ç—å composite `[dealId, createdAt]`, `[contactId, createdAt]`

### üü° –í–ê–ñ–ù–´–ï (–ø—Ä–∏–º–µ–Ω–∏—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è):

1. **Deal**: –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ `expectedCloseAt`, `closedAt`, `amount`, `[assignedToId, stageId]`
2. **Contact**: –ò–Ω–¥–µ–∫—Å –Ω–∞ `updatedAt`
3. **Company**: –ò–Ω–¥–µ–∫—Å –Ω–∞ `updatedAt`
4. **Partial –∏–Ω–¥–µ–∫—Å—ã**: –î–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–¥–µ–ª–æ–∫ –∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á (—á–µ—Ä–µ–∑ raw SQL)

### üü¢ –û–ü–¶–ò–û–ù–ê–õ–¨–ù–´–ï (–¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏):

1. **GIN –∏–Ω–¥–µ–∫—Å—ã**: –î–ª—è –º–∞—Å—Å–∏–≤–æ–≤ `tags` (—á–µ—Ä–µ–∑ raw SQL)
2. **–î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è**: `stageName`, `pipelineName`, `contactName`, `companyName` –≤ Deal
3. **JSONB –∏–Ω–¥–µ–∫—Å—ã**: –î–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ CustomFieldValue.value (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

---

## 7. –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ CSV (100k —Å—Ç—Ä–æ–∫):

| –û–ø–µ—Ä–∞—Ü–∏—è | –ë–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –° –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π | –£—Å–∫–æ—Ä–µ–Ω–∏–µ |
|----------|----------------|----------------|-----------|
| –ü–æ–∏—Å–∫ Contact –ø–æ email/phone | 10,000 —Å–µ–∫ | 100 —Å–µ–∫ | **100x** |
| –ü–æ–∏—Å–∫ Company –ø–æ name | 1,000 —Å–µ–∫ | 10 —Å–µ–∫ | **100x** |
| –û–±—â–∏–π –∏–º–ø–æ—Ä—Ç | ~3 —á–∞—Å–∞ | ~2 –º–∏–Ω—É—Ç—ã | **90x** |

### –ü—Ä–∏ –æ–±—ã—á–Ω–æ–π —Ä–∞–±–æ—Ç–µ:

| –ó–∞–ø—Ä–æ—Å | –ë–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –° –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π | –£—Å–∫–æ—Ä–µ–Ω–∏–µ |
|--------|----------------|----------------|-----------|
| –°–ø–∏—Å–æ–∫ —Å–¥–µ–ª–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ | 200ms | 10ms | **20x** |
| Timeline –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ | 30ms | 5ms | **6x** |
| –ü–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ | 50ms | 5ms | **10x** |

---

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞**: 2024
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –ø–µ—Ä–µ–¥ –º–∞—Å—Å–æ–≤—ã–º –∏–º–ø–æ—Ä—Ç–æ–º

